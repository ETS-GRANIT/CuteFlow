#!/usr/bin/bash

#Utilisation: ./gen_results nombre_cas_simul nombre_gpu_par_simul

if [ $# -le 1 ]; then
  echo "Utilisation: ./gen_results nombre_cas_simul nombre_gpu_par_simul"
  echo "Exemple: ./gen_results 10 2"
  echo "Pour générer un fichier solution à partir de 10 cas tests chacun ayant utilisé 2GPU,"
  exit
fi

if [ ! -d results ]; then
  mkdir results
else
  if [ $(ls results/ | wc -l) -ge 1 ]; then
    echo "[*] Attention les fichiers dans le dossier results vont être éffacés "
    rm results/*
  fi
fi

cd results
let ngpu=$2
let min=0
for i in `seq 1 $1`;do
  echo "[*] Traitement du cas $i"
  cd ../multi_$i
  if [ $(wc -l 0_SOLUTION_FINALE_PAR_ELEMENT.txt | cut -d " " -f 1) -ge 1 ]; then
    echo "[+] Cas $i, Fichiers solutions trouvés"
    ../base_files/merge_solutions SOLUTION_FINALE_PAR_ELEMENT.txt $ngpu
    cat SOLUTION_FINALE_PAR_ELEMENT.txt >> ../results/TOUTES_SOLUTIONS_FINALES.txt
    let min=$min+1
  else
    echo "[-] Cas $i, Aucun fichier solution trouvé !!"
  fi
  cd ../results
done

if [ $min -ge 1 ];then
  echo "[+] $min Cas ont produits des solutions"
  echo "Fichiers de solution créé, results/TOUTES_SOLUTIONS_FINALES.txt"
else
  echo "[-] Aucun cas n'as produit de solution"
  echo "[-] Aucun fichier de solution produit"
fi
